<mat-toolbar>
  Please select columns/rows for your AdHoc Report
</mat-toolbar>

<div class="report-container" *ngIf="tables.length > 0">
  <div class="drag-container">
    <div *ngFor="let t of tables">
      {{t.name}}
      <button *ngFor="let c of t.columns" mat-raised-button draggable [dragData]="c" disableRipple class="stretched-button">{{c.name}}</button>
    </div>
  </div>
  <div class="info-container">
    <div class="drop-container mat-elevation-z1" droppable (onDrop)="onColumnDrop($event)">
      <span class="description" *ngIf="columns.length === 0">Drop your columns here...</span>
      <span *ngIf="columns.length > 0" class="title">Columns: </span>
      <button *ngFor="let c of columns" mat-raised-button disableRipple class="stretched-button">
        {{c.tableName  + '.' + c.name}}
        <mat-icon (click)="cancelColumn(c)">cancel</mat-icon>
      </button>
    </div>
    <div class="drop-container mat-elevation-z1" droppable (onDrop)="onRowDrop($event)">
      <span class="description" *ngIf="rows.length === 0">Drop your rows here...</span>
      <span *ngIf="rows.length > 0" class="title">Rows: </span>
      <button *ngFor="let r of rows" mat-raised-button disableRipple class="stretched-button">
        {{r.aggregation + '(' + r.column.tableName + '.' + r.column.name + ')'}}
        <mat-icon (click)="cancelRow(r)">cancel</mat-icon>
      </button>
    </div>
    <div class="data mat-elevation-z1" *ngIf="tableDataSource && resultTableHeaders && reportType === 'table'">
      <mat-table #table [dataSource]="tableDataSource" matSort>
        <ng-container *ngFor="let h of resultTableHeaders" matColumnDef={{h}}>
          <mat-header-cell *matHeaderCellDef mat-sort-header>{{h}}</mat-header-cell>
          <mat-cell *matCellDef="let data" class="left-align">{{data[h]}}
          </mat-cell>
        </ng-container>
        <mat-header-row *matHeaderRowDef="resultTableHeaders"></mat-header-row>
        <mat-row *matRowDef="let data; columns: resultTableHeaders;"></mat-row>
      </mat-table>
      <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" showFirstLastButtons></mat-paginator>
    </div>
    <div class="data mat-elevation-z1" *ngIf="resultTable && reportType === 'crosstab'">
      <app-crosstab [table]="resultTable"></app-crosstab>
    </div>
    <div class="data mat-elevation-z1" *ngIf="resultTable && reportType === 'chart'">
      <app-echart [table]="resultTable" [config]="chartConfig"></app-echart>
    </div>
  </div>

  <div class="filters-container">
    <mat-button-toggle-group [(ngModel)]="reportType" (change)="onReportTypeChange()" class="type-toggle">
      <mat-button-toggle value="table" matTooltip="Table">
        <mat-icon>view_column</mat-icon>
      </mat-button-toggle>
      <mat-button-toggle value="crosstab" [disabled]="isTable()" matTooltip="Crosstab">
        <mat-icon>view_quilt</mat-icon>
      </mat-button-toggle>
      <mat-button-toggle value="chart" [disabled]="isTable()" matTooltip="Chart">
        <mat-icon>timeline</mat-icon>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>
</div>

